<?php
/**
 * Magento
 *
 * NOTICE OF LICENSE
 *
 * This source file is subject to the Academic Free License (AFL 3.0)
 * that is bundled with this package in the file LICENSE_AFL.txt.
 * It is also available through the world-wide-web at this URL:
 * http://opensource.org/licenses/afl-3.0.php
 * If you did not receive a copy of the license and are unable to
 * obtain it through the world-wide-web, please send an email
 * to license@magento.com so we can send you a copy immediately.
 *
 * DISCLAIMER
 *
 * Do not edit or add to this file if you wish to upgrade Magento to newer
 * versions in the future. If you wish to customize Magento for your
 * needs please refer to http://www.magento.com for more information.
 *
 * @category    design
 * @package     rwd_default
 * @copyright   Copyright (c) 2006-2015 X.commerce, Inc. (http://www.magento.com)
 * @license     http://opensource.org/licenses/afl-3.0.php  Academic Free License (AFL 3.0)
 */
?>
<?php
/**
 * Template for Mage_Page_Block_Html
 */
?>

<!DOCTYPE html>

<!--[if lt IE 7 ]> <html lang="<?php echo $this->getLang(); ?>" id="top" class="no-js ie6"> <![endif]-->
<!--[if IE 7 ]>    <html lang="<?php echo $this->getLang(); ?>" id="top" class="no-js ie7"> <![endif]-->
<!--[if IE 8 ]>    <html lang="<?php echo $this->getLang(); ?>" id="top" class="no-js ie8"> <![endif]-->
<!--[if IE 9 ]>    <html lang="<?php echo $this->getLang(); ?>" id="top" class="no-js ie9"> <![endif]-->
<!--[if (gt IE 9)|!(IE)]><!--> <html lang="<?php echo $this->getLang(); ?>" id="top" class="no-js"> <!--<![endif]-->

<head>
	<?php echo $this->getChildHtml('head') ?>
</head>
<body<?php echo $this->getBodyClass()?' class="'.$this->getBodyClass().'"':'' ?>>
<?php echo $this->getChildHtml('after_body_start') ?>
<div class="wrapper">
	<?php echo $this->getChildHtml('global_notices') ?>
	<div class="page">
		<?php echo $this->getChildHtml('header') ?>
		<div class="main-container col1-layout">
			<div class="main samples">
				<?php echo $this->getChildHtml('breadcrumbs') ?>
				<div class="col-main">
					<?php echo $this->getChildHtml('global_messages') ?>
                                    <div class="fabric-scissors">
                                        
                                    </div>	
                                    <h1 class="section-header"><span>Order your free samples</span></h1>                                    
                                    <?php echo $this->getChildHtml('content') ?>
                                    <!--<p>Order up to eight free samples to go in your cosy pack and we'll pop it in the post for you right away. 
                                        Don't know your chalk from yoour chilli? No worries, just give us a call on 0845 468 0577 and we can talk
                                        you through our lovely fabrics and find the right ones for you.
                                    </p>
                                    <div class="image">
                                        <div class="label1">
                                            Your samples come in our handy cosy pack
                                        </div>
                                        <img/>
                                        <div class="label2">
                                            Our leaflet shows a selection of sofa and talks about our ethos and how to order.
                                        </div>
                                    </div>-->
                                    <?php 

	if (Mage::getSingleton('customer/session')->isLoggedIn()) {

	/* Get the customer data */
	$customer = Mage::getSingleton('customer/session')->getCustomer();
	/* Get the customer's full name */
	$fullname = $customer->getName();
	/* Get the customer's first name */
	$fname= $customer->getFirstname();
	/* Get the customer's last name */
	$last_name = $customer->getLastname();
	/* Get the customer's email address */
	$email = $customer->getEmail();

		if($customer->getPrimaryBillingAddress()!="")
		{
		$tel = $customer->getPrimaryBillingAddress()->getTelephone();
		$address = $customer->getPrimaryBillingAddress()->getStreet();
		$address = $address[0];
		$city = $customer->getPrimaryBillingAddress()->getCity();
		$postcode = $customer->getPrimaryBillingAddress()->getPostcode();
		}

	} 				
	$options=array_values($_GET['options']);
	$option_client=$options[0];
	?>
                                    <div class="mail-info">
                                        <img class="desktop" src="<?php echo Mage::getDesign()->getSkinUrl();?>images/cosy-pack-delivery.jpg"/>
                                        <img class="mobile" src="<?php echo Mage::getDesign()->getSkinUrl();?>images/cosy-pack-delivery-mobile.jpg"/>
                                    </div>
                                    <div id="cosy-pack">
                                        <div id="error" style="display:none;">
                                            Your cosy pack is full to the brim (sorry, only eight swatches can fit!).
                                        </div>
                                        <div id="cosy-inner">
                                        <h2>My cosy pack fabric samples</h2>
                                        
                                        <div id='swatch-pack'>                                            
                                            <ul id="swatches">
                                                <li class="empty"><img src="<?php echo $this->getSkinUrl("images/addfabric.png") ;?>"/>
                                                <div class="swatch_name">Click on the fabric you want to add</div></li>
                                            </ul>
                                        </div>
                                        <div id='btnOrder'><button>Send me my<br/>scrumptious samples</button></div>
                                        <div id="order-samples-form">
                                            <div class="close">Close</div>
                                            <h3>We just need a little more information</h3>
                                            <form onSubmit="return false;" action="https://www.willowandhall.co.uk/order" id="form_swatches" 
                                            name="form_swatches" method="post">
                                                <label class="required" for="firstname">First name</label><br/>
                                                <input type="text" id="swatch_fname" name="swatch_fname" value="<?php echo $fname;?>" class="required-entry"/><br/>
                                                
                                                <label class="required" for="lastname">Last name</label><br/>
                                                <input type="text" id="swatch_lname" name="swatch_lname" value="<?php echo $last_name ?>"  class="required-entry"/><br/>
                                                
                                                <label class="required" for="email">Email address</label><br/>
                                                <input type="email" class="required-entry validate-email" id="swatch_email" name="swatch_email" value="<?php echo $email; ?>"/><br/>
                                                
                                                <label for="telephone">Telephone</label><br/>
                                                <input type="text" class="validate-phoneLax" id="swatch_telephone" name="swatch_telephone" value="<?php echo $tel;?>"/><br/>
                                                
                                                <div class="fulladdress" style="display:block;">
                                                    <label class="required" for="address1">Address</label><br/>
                                                    <input type="text" class="order required-entry" name="billing[street][0]" id="billing:street1" placeholder="Address Line 1" value="<?php echo $address;?>"/>
	                                                <br/>
	                                                <br/>
                                                    <input type="text" name="billing[street][1]" id="billing:street2" placeholder="Address Line 2"/><br/>
                                                    
                                                    <label class="required" for="city">City/Town</label><br/>
                                                    <input class="required-entry" type="text" name="billing[city]" value="<?php echo $city;?>"/>
                                                    
                                                    <input type="hidden" name="billing[country_id]" id="billing:country_id" value="GB" /><br/>
                                                </div>
                                                <label class="required  validate-zip-international " for="Postcode">Postcode</label><br/>
                                                <input class="required-entry" type="text" name="billing[postcode]" id="billing:postcode" value="<?php echo $postcode;?>" /> 
                                                 <div id="crafty_postcode_result_display_2" class="postcode_result_display" style="line-height: initial;" >&nbsp;</div>
                                               
                                                <button type="button" class="lookup" onclick="cp_obj_2.doLookup()">Look up address</button><br/>
<!--
                                                <a href="javascript:void(0);" class="manual-address">Or enter address manually here</a>
                                                
-->
                                                <input type="hidden" name="order" id="order" value="<?php echo $option_client; ?>">
												<input type="hidden" class="is_validated_swatch" name="is_validated" value="0" />
												<input type="hidden" class="bypass1" name="bypass" value="0" />	
                                               
                                                <div id='btnSend'>
													<div id="swatches_progress_text">
														<button type="submit" id="submit-freeswatches" onClick="ajaxswatch()">Send me my<br/>cosy pack</button>
													</div>
												</div>
                                            </form>
                                        </div>
                                        </div>
                                        <div class="border-top-left"></div>
                                        <div class="border-top-right"></div>
                                        <div class="border-bottom-left"></div>
                                        <div class="border-bottom-right"></div>
                                    </div>
                                    <h2 class="section-header"><span>Select your free samples</span></h2>
                                    <p class='reminder'>Just a reminder...you may order up to eight of our lovely fabric samples.</p>
                                    <div class="guidance">
        <div class="icon"></div>
        <div class="text">
        <p>Need some guidance?</p>
        <a href="/fabric-guide">Read our W&amp;H fabric guide here</a>
        </div>
    </div>
                                    <div class="fabric-swatch" style="display:block">
  
<?php
//$_product    = $this->getProduct();

//$_attribute = $this->getAttributeObj();

$_jsonConfig = $this->getJsonConfig();
$_config = json_decode($_jsonConfig);

//$_swatchInnerWidth = $this->getSwatchInnerWidth();
//$_swatchInnerHeight = $this->getSwatchInnerHeight();
//$_swatchOuterWidth = $this->getSwatchOuterWidth();
//$_swatchOuterHeight = $this->getSwatchOuterHeight();

//$_attr = $_attribute->getProductAttribute();
//$_attrCode = $_attr->getAttributeCode();
//$_id = $_attribute->getAttributeId();

//Load the admin labels for the attribute
//$attributeId = $_attribute->getAttributeId();

	$eavAttribute = new Mage_Eav_Model_Mysql4_Entity_Attribute();
	$code = $eavAttribute->getIdByCode('catalog_product', "colorsofa");
	$attributeId = $code;

        $collection =Mage::getResourceModel('eav/entity_attribute_option_collection')
        ->setPositionOrder('asc')
        ->setAttributeFilter($attributeId)
        ->setStoreFilter(0)
        ->load();
                
$collection = $collection->toOptionArray();

$_fabricTypes = array();
$_patterns = array();
$_pallettes = array();
        
foreach ($collection as $_option) {   
    $labels = explode(" - ", $_option["label"]);
    $_fabricTypes[$labels[0]] = "1";
    $_patterns[$labels[1]] = "1";
    $_pallettes[$labels[2]] = "1";
    
}
$_currentFabric = "";

$_swatchArray = $_config->attributes->$_id;
?>


<dd class="clearfix swatch-attr<?php if ($_attribute->decoratedIsLast) echo ' last'; ?>" style="display:block;">
    <div class="fabric-filters">
        <div class="filters">
        <h3>Refine By: <span class="clearall">Clear all</span></h3>
            <div class="filter">
                <h3>Colour Pallette</h3>
                <ul>
                    <?php
                        foreach ($_pallettes as $_pallette=>$val) :                            
                    ?>
                    <li>
                        <input class="pallette" name="pallette-<?php echo strtolower(str_replace(array(" & ", ",", " "), array( "-","","-"), $_pallette));?>" type="checkbox"/>
                        <label for="pallette-<?php echo strtolower(str_replace(array(" & ", ",", " "), array( "-","","-"), $_pallette));?>"><?php echo $_pallette;?></label>
                    </li>
                    <?php 
                        endforeach;
                    ?>
                </ul>
                <h3>Fabric Type</h3>
                <ul>
                    <?php
                        foreach ($_fabricTypes as $_fabricType=>$val) :                            
                    ?>
                    <li>
                        <input class="fabric" name="fabric-<?php echo strtolower(str_replace(" ", "-", $_fabricType));?>" type="checkbox"/>
                        <label for="fabric-<?php echo strtolower(str_replace(" ", "-", $_fabricType));?>"><?php echo $_fabricType;?></label>
                    </li>
                    <?php 
                        endforeach;
                    ?>
                </ul>
                <h3>Pattern</h3>
                <ul>
                    <?php
                        foreach ($_patterns as $_pattern=>$val) :                            
                    ?>
                    <li>
                        <input class="pattern" name="pattern-<?php echo strtolower(str_replace(" ", "-", $_pattern));?>" type="checkbox"/>
                        <label for="pattern-<?php echo strtolower(str_replace(" ", "-", $_pattern));?>"><?php echo $_pattern;?></label>
                    </li>
                    <?php 
                        endforeach;
                    ?>
                </ul>
            </div>
        </div>
        <div class="perfect-fabric">
            <?php echo $this->getLayout()->createBlock('cms/block')->setBlockId('perfect_fabric')->toHtml();?>
        </div>
    </div>
    
    <div class="input-box grid" id="grid">
        
        <div class="grid-sizer"></div>
        <?php
            // Group swatches by fabric type  
        
        foreach ($_fabricTypes as $_fabric=>$_val) :
            ?>
        <div class="grid-item" id="fabric-<?php echo strtolower(str_replace(" ", "-", $_fabric));?>">
            
                <?php $first = true;?>
                <?php foreach ($collection as $_option): ?>
                    <?php
                
                    // Get the admin label for the option
                    $_option_id = $_option["value"];      

                    foreach ($collection as $option) {
                        if ($option['value'] == $_option_id) {
                            $adminLabel = $option["label"];
                            $labels = explode(" - ", $adminLabel);
                            $_fabricType = $labels[0];
                            $_pattern = strtolower(str_replace(" ", "-", $labels[1]));
                            $_pallette = strtolower(str_replace(array(" & ", ",", " "), array( "-","","-"), $labels[2]));
                            $_swatch = $labels[3];
                            break;
                        }
                    }                

                    // Include if in current fabric group
                    if ($_fabric != $_fabricType) {
                        continue;
                    }
                    
                    if ($first):
?>
            <h3 class="<?php echo strtolower(str_replace(" ", "-", $_fabric)); ?>">
                <span class="info-icon">i
                    <div style="display: none;" class="pin-arrow"></div>
                    <span class="info-block">
                        <?php 
                            $blockid = "fabric_info_".strtolower(str_replace(" ", "_", $_fabric));
                            echo Mage::app()->getLayout()->createBlock('cms/block')->setBlockId($blockid)->toHtml();
                        ?>
                    </span>                        
                </span>      
                <?php echo $_fabric ; ?>
            </h3>
            <ul id="configurable_swatch_<?php echo $_attrCode ?>" class="configurable-swatch-list clearfix">
                <?php   $first=false;?>
                <?php endif;
                    ;
                    $_optionCode = Mage::helper('configurableswatches')->getHyphenatedString($_option->label);
                    //$_swatchUrl = Mage::helper('configurableswatches/productimg')->getSwatchUrl($_product, $_option->label, $_swatchInnerWidth, $_swatchInnerHeight, $_swatchType);
                    $_swatchimg = strtolower(str_replace(" ", "-", $_swatch)).".png";                    
                    $_swatchUrl = Mage::getBaseUrl('media')."wysiwyg/swatches/$_swatchimg";
                    $_hasImage = !empty($_swatchUrl);
                    $_liClass = ' pattern-'.$_pattern.' pallette-'.$_pallette.' show-pallette show-pattern ';
                    $_aClass = 'swatch-link ';
                    if ($_hasImage) {
                        $_liClass .= $_swatchType == 'media' ? ' is-media' : '';
                        $_aClass .= ' has-image';
                    } elseif (strlen($_option->label) > 3) {
                        $_liClass .= ' wide-swatch';
                    }
                    ?>
                    <li class="option-<?php echo $_optionCode; ?><?php echo $_liClass; ?>" id="option<?php echo $_option->id; ?>">
                        <a href="javascript:void(0)" name="<?php echo $_optionCode; ?>" id="swatch<?php echo $_option->id; ?>" class="<?php echo $_aClass ?>" title="<?php echo $_option->label; ?>"
                           >
                    <span class="swatch-label">
                    <?php if ($_hasImage): ?>
                        <img id='<?php echo strtolower(str_replace(" ", "-", $_swatch)); ?>' data-fabric="<?php echo $_fabric;?>" src="<?php echo $_swatchUrl; ?>" alt="<?php echo $_swatch; ?>" title="<?php echo $_swatch; ?>"  />
                        <div class="swatchname"><?php echo $_swatch; ?></div>
                        <div class="pin-arrow"></div>
                    <?php else: ?>
                        <?php echo $_swatch; ?>
                    <?php endif; ?>
                     </span>
                            <span class="x">X</span>
                        </a>
                        <div class="swatch-expand">
                            <img src="<?php echo $_swatchUrl; ?>" alt="<?php echo $_swatch; ?>"  />
                            <div class="info">
                                <?php echo $_fabric." - ". $_swatch;?>                                
                                <div class="addlink"><a href="javascript:void(0);">Add sample to my cosy pack</a><span class="sample-info"></span></div>
                                
                            </div>
                        </div>    
                    </li>
                <?php endforeach; ?>
            </ul>
        </div>    
        <?php
        endforeach;
        ?>
    </div>
</dd>

                                    </div>
                                    
			</div>
		</div>
                <?php echo $this->getLayout()->createBlock('core/template')->setTemplate('configurableswatches/catalog/product/view/type/configurable/swatch-js-custom.phtml')->toHtml(); ?>
                    
        </div>            
		<?php echo $this->getChildHtml('footer_before') ?>
		<?php echo $this->getChildHtml('footer') ?>
		<?php echo $this->getChildHtml('global_cookie_notice') ?>
		<?php echo $this->getChildHtml('before_body_end') ?>
	
</div>
<?php echo $this->getAbsoluteFooter() ?>
</body>
</html>


<script type="text/javascript">
    
    $j(function(){
        
        freeswatches.bindSwatch();
        freeswatches.getStoredSwatches();
        //freeswatches.setupFabricHover();
        
        $j("#btnOrder").click( function() {
           $j("#order-samples-form").show(500); 
        });
        
        $j("#order-samples-form .close").click( function() {
            $j("#order-samples-form").hide(500); 
        });
        
        $j(".manual-address").click( function() {
           $j(".fulladdress").show(500); 
        });
        
    });
    
    var freeswatches = function(){
        var oldCounter = 0;

        return {
            bindSwatch: function(){
                $j(".swatch-label img").click(freeswatches.addSwatchToPack);
                $j(".swatch-expand a").click(function(){
                    $j(this).parent().parent().parent().parent().find(".swatch-label img").click();
                })
            },
            addSwatchToPack: addSwatchToPack,
            getStoredSwatches: getStoredSwatches,
            setCounter: function(current){
                oldCounter = current;
            }
        };
        
        function addSwatchToPack() {
            counter = $j(".swatch").length;
            if (counter == 8) {
                $j("#error").modal();
                return;
            }
            
            swatchId = $j(this).attr("id");
            swatchFabric = $j(this).attr("data-fabric");
            swatchName = $j(this).attr("title");
            src = $j(this).attr("src");
            
            if ($j("#s_"+swatchId).length) {
            
            }
            else {
                addSwatch("#"+swatchId);
                
                counter = $j(".swatch").length;
         
                Mage.Cookies.set('counter', counter);
                Mage.Cookies.set('fabric_id_' + counter, swatchId);
                jQuery('html, body').animate({scrollTop: $j("#cosy-pack").offset().top}, 800);
            }
            
        }
        
        function removeSwatch(){
            swatchId = $j(this).parent().attr("id");
            
            $j("#"+swatchId).remove();
            
            counter = $j(".swatch").length;
            Mage.Cookies.set('counter', counter);
            
            if (counter == 0) {
                $j('#btnOrder').hide();
            }

            $j(".swatch").each( function (index,value){
                var id = $j(value).attr("id");
                //alert('fabric_id_' + (index+1)+","+ id.replace("s_",""));
                Mage.Cookies.set('fabric_id_' + (index+1), id.replace("s_",""));                 
            });
        }
        
           /*
        * get stored swatches from cookies
        */
        function getStoredSwatches(){
           targets = new Array();
           counter = Mage.Cookies.get('counter');
           freeswatches.setCounter(counter);
           for (i = 1; i <= counter; i++) {  
               var fabric_id = Mage.Cookies.get('fabric_id_' + i);
               addSwatch("#"+fabric_id);
           }
        }

        function addSwatch(id) {
            swatchId = $j(id).attr("id");
            swatchFabric = $j(id).attr("data-fabric");
            swatchName = $j(id).attr("title");
            src = $j(id).attr("src");
            $j('#btnOrder').show();
            $j("<li class='swatch' id='s_"+swatchId+"'><img src='"+src+"'/><div class='swatch-frame'></div><div class='close'></div><div class='swatch_name'>"+swatchFabric+"<br/>"+swatchName+"</div></li>").insertBefore("#swatches .empty");
            $j("#s_"+swatchId+" .close").click(removeSwatch);            
        }
       
        
    }(); 
      function getImagearray(){
			var swatch=[];var swatch_name;
			$j( "li.swatch" ).each(function( index ) {
				swatch_name=$j( this ).attr("id");
			  swatch.push(swatch_name.replace("s_","" ));
			});
			//swatch.push($j("#swatches").find("li.swatch").attr("id"));
			return swatch;
		}   
</script>
  
     <script language="Javascript" type="text/javascript">
		   /***********Swatch order place related javascript***************************/
	<!-- Hide script
		//<![CDATA[
				var swatch_form=new VarienForm('form_swatches',true);
		//]]> End script hiding -->
	var fd1 = jQuery('#form_swatches').serialize();			                         
	var global=false;                         
	function ajaxswatch(){
		//alert("in ajax");
		var swatch_array;
		swatch_array=getImagearray().toString();
		jQuery("#order").val(swatch_array);
		//break;
		// var swatch_form=new VarienForm('form_swatches',false);
		if(global==true)
				return true;
	if(swatch_form.validator.validate()){
		jQuery("body").prepend('<div id="product_extra_image_ajax_load"></div>');
		jQuery("#submit-freeswatches").attr('disabled','disabled');
		jQuery("#submit-freeswatches").prop('disabled', true);
		var fd1 = jQuery('#form_swatches').serialize();
		jQuery.ajax({
			type: "POST",
			cache: false,
			//processData: false,
			async:false,
			//contentType: "text/json; charset=utf-8",			
			//contentType: false, 
			url: '<?php echo $this->getUrl();?>requester/SwatchRequest/googleValidation',
			data:fd1,
			dataType: 'json',
			success: function(data) {//alert(data);
			var toAppend = '';
		if(data.length>1)
		{
			for(var i=0;i<data.length;i++){
					toAppend += '<option>'+data[i]+'</option>';
			}
			//alert(toAppend);
			jQuery("#populateaddress1").html(toAppend);
			var left = (screen.width/2)-(320/2);
			//var top = (screen.height/2)-(320/2);
			//jQuery(".addregion").css('top',top);
			jQuery(".addregion1").css('left',left);
			jQuery(".addregion1").show();	
			jQuery(".billing_cp_result_display").hide();
			jQuery("#simplemodal-overlay-popup5").show();
			jQuery("#submit-freeswatches").removeAttr('disabled');
		}
		else if(data.length==0)
		{
			if(jQuery(".bypass1").val()==1)
			{
				validateswatchaftercall();
			}
			else
			{
				no_result_action_swatch();
				jQuery("#submit-freeswatches").removeAttr('disabled');
			}
		}
		else
		{
			jQuery(".is_validated_swatch").val('1');
			validateswatchaftercall();
			} 
            //jQuery("#populateaddress").html(data);
        },
       // sucess:function(data) {console.log(data);alert(data);populateAddress(jQuery("#populateaddress"), data);},
    error:function (xhr, ajaxOptions, thrownError) {
        console.log(xhr.status);
        console.log(thrownError);
      }
	});
	jQuery('#product_extra_image_ajax_load').remove();
	return false;
	}
	else
	{
		return false;

		}
	}
 	 function no_result_action_swatch()
	{
		var left = (screen.width/2)-(320/2);
		var left_in_percent = (left*100)/screen.width;
		var top = (screen.height/2)-(470/2);
		jQuery(".no_result1").css('top','15%');
		jQuery(".no_result1").css('left',left_in_percent+'%');
	  	jQuery(".no_result1").show();	
	  	jQuery("#simplemodal-overlay-popup5").show();
	
	}

	function validateswatchaftercall()
	{
		//alert("in validation");
		jQuery("#submit-freeswatches").hide();
		jQuery("#swatches_progress_text").html('Please wait while submission is in progress...');
		jQuery("#swatches_progress_text").css('text-align','center');
		jQuery("#swatches_progress_text").css('font-family','Georgia');
		jQuery("#swatches_progress_text").css('font-size','16px');
		jQuery("#swatches_progress_text").css('color','#666666');
		//alert("testing");
		jQuery.ajax({
			 type: "POST",
	         cache: false,
			 //processData: false,
			 async:false,
			 //contentType: "text/json; charset=utf-8",			
			 //contentType: false, 
			 url: '<?php echo $this->getUrl();?>requester/SwatchRequest/index',
	         data:jQuery('#form_swatches').serialize(),
			 dataType: 'json',
	         success: function(data) {   if(data){ window.location="<?php echo $this->getBaseUrl();?>index.php/order-sent";}else{window.location="<?php echo $this->getBaseUrl();?>index.php/free-samples"; }}
		});
		
		
    }
	
	jQuery( ".google_validate_button1_ok").click(function() {
		
		//alert(jQuery("#populateaddress").val());

		var fulladdr=jQuery("#populateaddress1").val();
		var field=[".billing_postcode",".billing_city",".billing_street1",".billing_street2"]
		var res = fulladdr.split(","); 
		//alert(res.length);
		
		var j=0;
		//alert(jQuery("#broc:postcode").val());

		
		for(var i=(res.length-1);i>=0;i--)
		{
				jQuery(field[j]).val(res[i]);
				//alert(field[j]+": "+jQuery(field[j]).val());
				//alert(res[i]);
				j++;
		}
		//jQuery("#form_swatches").submit(); 
		jQuery(".is_validated_swatch").val('1');
		validateswatchaftercall();
		jQuery(".addregion1 ,#simplemodal-overlay-popup5").hide();
		
		
		});

	
	/******************end of swatch order*********************************************************/
</script>
           
    
    <style>

.validation-advice{margin-left:80px;}
</style>
<div class="addregion1" style="text-align:center;top:320px;width:320px;display:none;z-index:99999999;background-color: #FFFFFF;padding: 30px;position: fixed;top:100px;">

YOUR ADDRESS DID NOT MATCHED PLEASE SELECT FROM BELOW:
<br><br>
<select id="populateaddress1" size="5"></select>
<br><br>
<button class="google_validate_button1_ok google_button" name="Ok" style="width:110px;">OK</button>
<button class="google_validate_button1_cancel google_button" name="Keep As It is" >Keep As It is </button>
</div>
<div class="no_result1" style=" font-size:16px;color:#979695;text-align:center;width:320px;display:none;z-index:99999999;background-color: #FFFFFF;padding: 30px;position: fixed;top:100px;width:320px;display:none;z-index:99999999;background-color: #FFFFFF;padding: 30px;position: fixed;top:100px;">

Sorry the address is showing as incorrect in our checker.  Please could you double check your street and postcode and edit if necessary before submitting. If your address is valid and it's just our system being naughty apologies for this - please ignore.  <br><br>Best wishes, <br>The Willow and Hall Team.
<button  style="height:70px; width:260px;" type="button" class="google_validate_button_no_result_ok1 google_button" name="ok" >The address I entered <b>is not correct.</b> Take me back to edit my order</button>
<br /><br />
<button  style="height:70px; width:260px;" type="button" class="google_validate_button_no_result_cancel1 google_button" name="cancel" >The address I entered <b>is correct.</b> Take me back to submit my order</button>
</div>

    
    

